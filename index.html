<!DOCTYPE html>
<html>

<head>
  <title>Christ</title>
  <!-- <link rel="stylesheet" href="style.css"> -->
  <meta charset="utf-8" />
  <style>
    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
    }

    /* body {
      background-color: #000;
      height: full;
      opacity: .6;
    } */

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead th {
      background-color: #1a6195;
      color: #ffffff;
      text-align: left;
      padding: 10px;
    }

    tbody tr:nth-child(even) {
      background-color: #e3f0f9;
    }

    th,
    tbody td {
      padding: 15px;
    }

    #header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      /* margin-bottom: 20px; */
      padding: 10px;
    }

    #checkbox {
      margin-right: auto;
    }

    #filter {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #signout {
      margin-left: auto;
    }

    #container {
      width: 100vw;
      height: 100vh;
      position: relative;
      overflow: hidden;
      /* z-index: 1; */
    }

    .wrapper {
      width: 100%;
      height: 100%;
      display: flex;
      animation: slide 16s infinite;
      background-color: black;
    }

    .slide {
      position: relative;
    }

    .slide::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.4);
      /* Change opacity if needed */
    }

    @keyframes slide {
      0% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(0);
      }

      30% {
        transform: translateX(-100%);
      }

      50% {
        transform: translateX(-100%);
      }

      55% {
        transform: translateX(-200%);
      }

      75% {
        transform: translateX(-200%);
      }

      80% {
        transform: translateX(-300%);
      }

      100% {
        transform: translateX(-300%);
      }
    }

    .slide {
      flex: 0 0 100%;
      width: 100%;
      height: 100%;
    }

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #text-wrapper {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      width: 100%;
    }

    .text {
      font-size: 32px;
      color: white;
      animation: scrollText 8s linear infinite;
      line-height: 2.5rem;
    }

    .sub-text {
      font-size: 20px;
    }


    @keyframes scrollText {
      0% {
        transform: translateY(-100%);
      }

      100% {
        transform: translateY(0);
      }
    }

    .optbtn {
      padding: 10px;
    }

    /* Button Styles */
    .btn {
      display: inline-block;
      padding: 8px;
      font-size: 14px;
      font-weight: bold;
      text-align: center;
      text-decoration: none;
      background-color: #1a6195;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      letter-spacing: 0.5px;
      margin-top: 15px;
    }

    .btn:hover {
      background-color: #2276b4;
    }

    .btn:active {
      background-color: #2e8ace;
    }

    .btn:focus {
      outline: none;
    }

    #header {
      margin-left: 20px;
      margin-right: 20px;
      margin-top: -520px;
      position: relative;
      z-index: 2;
      background-color: #ffffff;
      opacity: 0.9;
    }

    #content {
      margin-bottom: 20px;
      margin-left: 20px;
      margin-right: 20px;
      position: relative;
      z-index: 2;
      background-color: #ffffff;
      opacity: 0.9;
    }
  </style>
</head>

<body>
  <!-- <p>Google Calendar API Quickstart</p> -->

  <!--Add buttons to initiate auth sequence and sign out-->
  <div id="container">
    <div class="wrapper">
      <div class="slide">
        <img src="./images/camp1.png">
      </div>
      <div class="slide">
        <img src="./images/camp3.jpg">
      </div>
      <div class="slide">
        <img src="./images/camp4.png">
      </div>
      <div class="slide">
        <img src="./images/camp5.jpg">
      </div>
    </div>
  </div>

  <div id="text-wrapper">
    <h1 class="text">CHRIST<br /><span class="sub-text">(DEEMED TO BE UNIVERSITY)</span></h1>
    <div>
      <button id="authorize_button" onclick="handleAuthClick()" class="btn">LOGIN</button>
    </div>
  </div>



  <!-- <button id="authorize_button" onclick="handleAuthClick()">Authorize</button> -->


  <div id="header">
    <div id="checkbox">
      <input type="checkbox" id="myCheckbox" onchange="handleCheckboxChange()" />All Events
    </div>
    <div id="filter">
      <span>
        <button class="optbtn" style="background-color: white; border: none;" onclick="prevEvents()">
          <img src="./images/image2.png" alt="Button Image" style="width: 10px; height: 10px; border: none; background: white;">
        </button>
      </span>
      <input type="date" id="myDate" value="" />
      <span>
        <button class="optbtn" style="background-color: white; border: none;" onclick="nextEvents()">
          <img src="./images/image1.png" alt="Button Image" style="width: 10px; height: 10px; border: none; background: white;">
        </button>
      </span>
    </div>
    <div id="signout">
      <button id="signout_button" onclick="handleSignoutClick()">Sign Out</button>
    </div>
  </div>


  <pre id="content" style="white-space: pre-wrap;"></pre>
  
  <script type="text/javascript">
    /* exported gapiLoaded */
    /* exported gisLoaded */
    /* exported handleAuthClick */
    /* exported handleSignoutClick */


    const CLIENT_ID = '522560370970-p2u1rca9lc89bod1v44mr08g106869rn.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDLtZeBE4IPvKTa43R52ZeXcZpUTjtPI8w';

    // Discovery doc URL for APIs used by the quickstart
    const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';

    // Authorization scopes required by the API; multiple scopes can be
    // included, separated by spaces.
    const SCOPES = 'https://www.googleapis.com/auth/calendar.readonly';

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;

    // document.getElementById('authorize_button').style.visibility = 'hidden';
    // document.getElementById('signout_button').style.visibility = 'hidden';
    document.getElementById('header').style.visibility = 'hidden';
    document.getElementById('container').style.visibility = 'hidden';
    /**
    * Setting date.
    */
    var currentDate = new Date();
    // Format the date in YYYY-MM-DD format
    var year = currentDate.getFullYear();
    var month = String(currentDate.getMonth() + 1).padStart(2, '0');
    var day = String(currentDate.getDate()).padStart(2, '0');
    var formattedDate = year + '-' + month + '-' + day;
    // Set the value of the input field
    document.getElementById('myDate').value = formattedDate;

    /**
     * Callback after api.js is loaded.
     */
    function gapiLoaded() {
      gapi.load('client', initializeGapiClient);
    }

    /**
     * Callback after the API client is loaded. Loads the
     * discovery doc to initialize the API.
     */
    async function initializeGapiClient() {
      await gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: [DISCOVERY_DOC],
      });
      gapiInited = true;
      maybeEnableButtons();
    }

    /**
     * Callback after Google Identity Services are loaded.
     */
    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: '', // defined later
      });
      gisInited = true;
      //maybeEnableButtons();
    }

    /**
     * Enables user interaction after all libraries are loaded.
     */
    function maybeEnableButtons() {
      if (gapiInited && gisInited) {
        document.getElementById('container').style.visibility = 'visible';
      }
    }

    /**
     *  Sign in the user upon button click.
     */
    function handleAuthClick() {
      tokenClient.callback = async (resp) => {
        if (resp.error !== undefined) {
          throw (resp);
        }

        document.getElementById('signout_button').style.visibility = 'visible';
        // document.getElementById('authorize_button').style.visibility = 'hidden';
        document.getElementById('header').style.visibility = 'visible';

        document.getElementById('text-wrapper').style.visibility = 'hidden';

        var container = document.getElementById("container");
        container.setAttribute("style", "position: relative; z-index: 1;");

        //await listUpcomingEvents();
        document.getElementById('container').style.visibility = 'visible';


        currEvents();
      };

      if (gapi.client.getToken() === null) {
        // Prompt the user to select a Google Account and ask for consent to share their data
        // when establishing a new session.
        tokenClient.requestAccessToken({ prompt: 'consent' });
      } else {
        // Skip display of account chooser and consent dialog for an existing session.
        tokenClient.requestAccessToken({ prompt: '' });
      }
    }

    /**
     *  Sign out the user upon button click.
     */
    function handleSignoutClick() {
      const token = gapi.client.getToken();
      if (token !== null) {
        google.accounts.oauth2.revoke(token.access_token);
        gapi.client.setToken('');
        document.getElementById('content').innerText = '';
        //document.getElementById('authorize_button').innerText = 'Authorize';
        document.getElementById('signout_button').style.visibility = 'hidden';
      }
    }

    function handleCheckboxChange() {
      const checkbox = document.getElementById('myCheckbox');
      if (checkbox.checked) {
        listUpcomingEvents();
      } else {
        currEvents();
      }
    }

    async function listUpcomingEvents() {
      let response;
      try {
        const request = {
          'calendarId': 'primary',
          'timeMin': (new Date()).toISOString(),
          'showDeleted': false,
          'singleEvents': true,
          'maxResults': 10,
          'orderBy': 'startTime',
        };
        response = await gapi.client.calendar.events.list(request);
      } catch (err) {
        document.getElementById('content').innerText = err.message;
        return;
      }

      const events = response.result.items;
      if (!events || events.length === 0) {
        document.getElementById('content').innerText = 'No events found.';
        return;
      }

      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      const headers = ['Name', 'Date', 'Venue', 'Start Time', 'End Time'];

      headers.forEach(headerText => {
        const headerCell = document.createElement('th');
        headerCell.textContent = headerText;
        headerRow.appendChild(headerCell);
      });

      thead.appendChild(headerRow);
      table.appendChild(thead);

      const tbody = document.createElement('tbody');

      events.forEach(event => {
        const name = event.summary || '-';
        const venue = event.location || '-';
        const startTime = event.start.dateTime || '-';
        const endTime = event.end.dateTime || '-';

        const startDate = new Date(startTime);
        const formattedDate = isNaN(startDate) ? '-' : `${startDate.getDate()}-${startDate.getMonth() + 1}-${startDate.getFullYear()}`;

        const startTimeFormatted = startTime !== '-' ? startTime.slice(11, 19) : '-';
        const endTimeFormatted = endTime !== '-' ? endTime.slice(11, 19) : '-';

        const row = document.createElement('tr');
        const nameCell = document.createElement('td');
        nameCell.textContent = name;
        row.appendChild(nameCell);

        const dateCell = document.createElement('td');
        dateCell.textContent = formattedDate;
        row.appendChild(dateCell);

        const venueCell = document.createElement('td');
        venueCell.textContent = venue;
        row.appendChild(venueCell);

        const startCell = document.createElement('td');
        startCell.textContent = startTimeFormatted;
        row.appendChild(startCell);

        const endCell = document.createElement('td');
        endCell.textContent = endTimeFormatted;
        row.appendChild(endCell);

        tbody.appendChild(row);
      });

      table.appendChild(tbody);
      document.getElementById('content').innerHTML = '';
      document.getElementById('content').appendChild(table);
    }


    function currEvents() {
      const currentDate = new Date();
      const formattedDate = formatDate(currentDate); // Assuming formatDate is a function to format the date as needed
      document.getElementById('myDate').value = formattedDate;
      listEventsForDate(formattedDate);
    }

    function prevEvents() {
      const currentDate = new Date(document.getElementById('myDate').value);
      currentDate.setDate(currentDate.getDate() - 1);
      const formattedDate = formatDate(currentDate);
      document.getElementById('myDate').value = formattedDate;
      listEventsForDate(formattedDate);
    }

    function nextEvents() {
      const currentDate = new Date(document.getElementById('myDate').value);
      currentDate.setDate(currentDate.getDate() + 1);
      const formattedDate = formatDate(currentDate);
      document.getElementById('myDate').value = formattedDate;
      listEventsForDate(formattedDate);
    }



    async function listEventsForDate(date) {

      let response;
      try {
        const startOfDay = new Date(date);
        const endOfDay = new Date(date);
        endOfDay.setDate(endOfDay.getDate() + 1);

        const request = {
          'calendarId': 'primary',
          'timeMin': startOfDay.toISOString(),
          'timeMax': endOfDay.toISOString(),
          'showDeleted': false,
          'singleEvents': true,
          'maxResults': 10,
          'orderBy': 'startTime',
        };
        response = await gapi.client.calendar.events.list(request);
      } catch (err) {
        document.getElementById('content').innerText = err.message;
        return;
      }

      const events = response.result.items;
      if (!events || events.length === 0) {
        document.getElementById('content').innerText = 'No events found.';
        return;
      }

      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      const headers = ['Name', 'Date', 'Venue', 'Start', 'End'];

      headers.forEach(headerText => {
        const headerCell = document.createElement('th');
        headerCell.textContent = headerText;
        headerRow.appendChild(headerCell);
      });

      thead.appendChild(headerRow);
      table.appendChild(thead);

      const tbody = document.createElement('tbody');

      events.forEach(event => {
        const name = event.summary || '-';
        const venue = event.location || '-';
        const startTime = event.start.dateTime || '-';
        const endTime = event.end.dateTime || '-';

        const startDate = new Date(startTime);
        const formattedDate = isNaN(startDate) ? '-' : `${startDate.getDate()}-${startDate.getMonth() + 1}-${startDate.getFullYear()}`;

        const startTimeFormatted = startTime !== '-' ? startTime.slice(11, 19) : '-';
        const endTimeFormatted = endTime !== '-' ? endTime.slice(11, 19) : '-';

        const row = document.createElement('tr');
        const nameCell = document.createElement('td');
        nameCell.textContent = name;
        row.appendChild(nameCell);

        const dateCell = document.createElement('td');
        dateCell.textContent = formattedDate;
        row.appendChild(dateCell);

        const venueCell = document.createElement('td');
        venueCell.textContent = venue;
        row.appendChild(venueCell);

        const startCell = document.createElement('td');
        startCell.textContent = startTimeFormatted;
        row.appendChild(startCell);

        const endCell = document.createElement('td');
        endCell.textContent = endTimeFormatted;
        row.appendChild(endCell);

        tbody.appendChild(row);
      });

      table.appendChild(tbody);
      document.getElementById('content').innerHTML = '';
      document.getElementById('content').appendChild(table);
    }

    function formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }
  </script>
  <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
  <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

</body>

</html>